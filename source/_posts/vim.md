# vi--终端中的编辑器

## 目标

* vi简介
* 打开和新建文件
* 三种工作模式
* 分屏命令
* 常用命令速查图

## 1. vi简介

1.1 学习vi的目的

1.2 vi和vim

## 2. 打开和新建文件

* 在终端输入vi在后面跟上文件名即可
* 如果文件已经存在，会直接打开该文件
* 如果文件不存在，会创建一个文件

2.1 打开文件并且定位行

* 在日常工作中，有可能会遇到打开个文件，并定位到指定行的情况

* 例如:在开发时，知道某-行代码有错误，可以快速定位到出错代码的位置

* 这个时候，可以使用以下命令打开文件

  ```bash
  $vi 文件名 +行号
  ```

  > 提示:如果只带上+而不指定行号，会直接定位到文件末尾

2.2 异常处理

* 如果vi异常退出，在磁盘上可能会保存有交换文件

* 下次再使用vi编辑该文件时，会看到以下屏幕信息，按下字母d可以删除交换文件即可

  > 提示：按下键盘时，注意关闭输入法

![1652711778504](1652711778504.png)

## 3. 三种工作模式

* vi有三种基本工作模式：
  1. 命令模式
     * 打开文件首先进入命令模式，是使用vi的入口
     * 通过命令对文件进行常规的编辑操作，例如:定位、翻页、复制、粘贴、删除.
     * 在其他图形编辑器下，通过快捷键或者鼠标实现的操作，都在命令模式下实现
  2. 末行模式--执行保存、退出等操作
     * 要退出vi返回到控制台，需要在末行模式下输入命令
     * 末行模式是vi的出口
  3. 编辑模式--正常的编辑文字

![1652711961673](1652711961673.png)

> 提示:在Touch Bar的Mac电脑上，按ESC不方便，可以使用CTRL + [替代

**末行模式命令**

| 命令 | 英文         | 功能                           |
| ---- | ------------ | ------------------------------ |
| w    | write        | 保存                           |
| q    | quit         | 退出，如果没有保存，不允许退出 |
| q!   | quit         | 强行退出，不保存退出           |
| wq   | write & quit | 保存并退出                     |
| x    |              | 保存并退出                     |

## 4. 常用命令

### 命令线路图

1. 重复次数
   - 在命令模式下，先输入-个数字，再跟上-个命令，可以让该命令重复执行指定次数
2. 移动和选择(多练)
   - vi之所以快，关键在于能够快速定位到要编辑的代码行
   - 移动命令能够和编辑操作命令组合使用
3. 编辑操作
   - 删除、复制、粘贴、替换、缩排
4. 撤销和重复
5. 查找替换
6. 编辑

### 学习提示

1. vi的命令较多，不要期望一 下子全部记住，个别命令忘记了，只是会影响编辑速度而已
2. 在使用vi命令时，注意关闭中文输入法

### 4.1 移动(基本)

* 要熟练使用vi，首先应该学会怎么在命令模式下样快速移动光标
* 编辑操作命令，能够和移动命令结合在一起使用

1. 上下左右

   | 命令 | 功能 | 手指   |
   | ---- | ---- | ------ |
   | h    | 向左 | 食指   |
   | j    | 向下 | 食指   |
   | k    | 向上 | 中指   |
   | l    | 向右 | 无名指 |

2. 行内移动

   | 命令 | 英文 | 功能                           |
   | ---- | ---- | ------------------------------ |
   | w    | word | 向后移动一个单词               |
   | b    | back | 向前移动一个单词               |
   | 0    |      | 行首                           |
   | ^    |      | 行首，第一个不是空白字符的位置 |
   | $    |      | 行尾                           |

3. 行数移动

   | 命令   | 英文 | 功能                 |
   | ------ | ---- | -------------------- |
   | gg     | go   | 文件顶部             |
   | G      | go   | 文件末尾             |
   | 数字gg | go   | 移动到数字对应的行数 |
   | 数字G  | go   | 移动到数字对应的行数 |
   | ：数字 |      | 移动到数字对应的行数 |

4. 屏幕移动

   | 命令   | 英文    | 功能     |
   | ------ | ------- | -------- |
   | ctrl+b | back    | 向上翻页 |
   | ctrl+f | forward | 向下翻页 |
   | H      | Head    | 屏幕顶部 |
   | M      | Middle  | 屏幕中间 |
   | L      | Low     | 屏幕底部 |

### 4.2 移动（程序）

1. 段落移动

   * vi中使用空行来区分段落

   * 在程序开发时，通常一段功能相关的代码会写在一起--之间没有空行

     | 命令 | 功能   |
     | ---- | ------ |
     | {    | 上一段 |
     | }    | 下一段 |

   

2. 括号切换

   * 在程序世界中，(),[],{}使用频率很高，而且都是成对出现的

   | 命令 | 功能           |
   | ---- | -------------- |
   | %    | 括号匹配及切换 |

3. 标记

   * 在开发时，某一块代码可能需要稍后处理，例如:编辑、查看

   * 此时先使用m增加一个标记，这样可以在需要时快速地跳转回来或者执行其他编辑操作

   * 标记名称可以是a~z或者A~Z之间的任意一个字母

   * 添加了标记的行如果被删除，标记同时被删除

   * 如果在其他行添加了相同名称的标记，之前添加的标记也会被替换掉

     | 命令 | 英文 | 功能                                         |
     | ---- | ---- | -------------------------------------------- |
     | mx   | mark | 添加标记x，x是a~z 或者A~Z之间的任意- -个字母 |
     | 'x   |      | 直接定位到标记x所在位置                      |

   

### 4.3 选中文本（可视模式）

* 学习复制命令前，应该先学会怎么样选中要复制的代码
* 在vi中要选择文本，需要先使用Visual 命令切换到可视模式
* vi中提供了三种可视模式，可以方便程序员选择选中文本的方式
* 按ESC可以放弃选中，返回到命令模式

| 命令   | 模式       | 功能                               |
| ------ | ---------- | ---------------------------------- |
| v      | 可视模式   | 从光标位置开始按照正常模式选择文本 |
| V      | 可视行模式 | 选中光标经过的完整行               |
| ctrl+v | 可视块模式 | 垂直方向选中文本                   |

* 可视模式下，可以和移动命令连用，例如: ( ggVG能够选中所有内容

### 4.4 撤销和恢复撤销

* 在学习编辑命创之前，先要知道怎样撤销之前一次错误的编辑动作!

| 命令   | 英文 | 功能           |
| ------ | ---- | -------------- |
| u      | undo | 撤销上次命令   |
| ctrl+r | redo | 恢复撤销的命令 |

### 4.5 删除命令

| 命令        | 英文   | 功能                            |
| ----------- | ------ | ------------------------------- |
| x           | cut    | 删除光标所在字符，或者选中文字  |
| d(移动命令) | delete | 删除移动命令对应的内容          |
| dd          | delete | 删除光标所在行，可以ndd删除多行 |
| D           | delete | 删除至行尾                      |

> 提示:如果使用可视模式已经选中了一段文本，那么无论使用d还是x，都可以删除选中文本

* 删除命令可以和移动命令连用，以下是常见的组合命令:

  > dw #从光标位置删除到单词末尾
  > de #从光标位置删除到一行的起始位置
  > d} #从光标位置删除到段落结尾
  > ndd #从光标位置向下连续删除n行
  > d代码行G #从光标所在行删除到指定代码行之间的所有传码
  > d'a #从光标所在行删除到标记a之间的所有代码